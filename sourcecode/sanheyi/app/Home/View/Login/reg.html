<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="keywords" content="java培训 , .net培训 , php培训" />
    <meta name="description" content="IT培训的龙头老大，口碑最好的XX培训" />
    <title>快速注册</title>
    <style type="text/css">
        @media screen and (max-width:1920px){
		    *{margin:0; padding:0;}
            .beijing{width:1000px; margin:0 auto; position:relative; z-index:0;}
			.beijing img{width:100%; position:relative; z-index:1;}
            .denglu{width:500px; height:600px; position:absolute; z-index:2;}
            .dl{position:absolute; top:2%; left:75%; z-index:2;}
            a{color:blue;}
            .tishi{color:red; float:right; line-height:50px; width:500px; height:50px; text-align:center;}
            .username{width:500px; height:50px; line-height:50px; float:left;}
            .two{width:525px; height:50px; margin-top:10px; float:left;}
            .inp{width:230px; height:30px; margin-top:10px; border:1px solid #c2c2c2; padding-left:5px;float:left;}
            .qian{width:100px; height:50px; line-height:50px; float:left; text-align:right;}
            .zhong,.hou{color:red;float: left;    height: 100%;line-height: 50px;};
            .xuan{margin-left:100px;}
            .tijiao{width:80px; height:40px; line-height:40px; border:none; color:#fff; background:#ffa32f; margin-left:100px;
                border-radius:5px; -webkit-border-radius:5px;; -moz-border-radius:5px;; -ms-border-radius:5px;;-o-border-radius:5px;;}
        }
        @media screen and (max-width:1520px){
        }
    </style>
     <script src="__PUBLIC__/js/jquery-3.0.0.min.js"></script> 
    <script src="__PUBLIC__/js/common.js"></script>
    <script src="__PUBLIC__/js/jquery.form.min.js"></script>
    <script src="__PUBLIC__/js/home/zhuce.js"></script> 
</head>

<body>
<div class="beijing"><!--此处可以用行间样式加背景图，背景图长宽比例最好是跟屏幕大小一致-->
    <img src="__PUBLIC__/images/beijing.jpg">
    <div class="dl">已经有了账号？<br />请直接<a href="{:U('Login/login')}">登录</a></div>
    <div class="denglu">
        <h1>会员注册</h1>
        <div class="tishi">年龄区间16-70岁之间</div>
        <form method="post"  method="post"  action="{:U('Login/regDo')}" name="form" id="form">
            <div class="username">
                <div class="qian">登录账号：</div>
                <input class="inp" type="text" placeholder="6-16位之间，注册后不能更改" id="name" name="name" />
                <span class="zhong">*</span>
                <span class="hou"></span>
            </div>
            <div class="two">
                <div class="qian">登录密码：</div>
                <input class="inp" type="password" placeholder="登录密码，6-16位之间" id="pwd" name="pwd" />
                <span class="zhong">*</span>
                <span class="hou"></span>
            </div>
            <div class="two">
                <div class="qian">确认密码：</div>
                <input class="inp" type="password" placeholder="确认密码和登录密码一致" id="repwd" name="repwd" />
                <span class="zhong">*</span>
                <span class="hou"></span>
            </div>
            <div class="two">
                <div class="qian">姓&nbsp;&nbsp;名：</div>
                <input class="inp" type="text" placeholder="身份证上的姓名"  id="family_name" name="family_name" />
                <span class="zhong">*</span>
                <span class="hou"></span>
            </div>
            <div class="two">
                <div class="qian">手机号码：</div>
                <input class="inp" type="text" placeholder="手机号码"  id="mobile" name="mobile" />
                <span class="zhong">*</span>
                <span class="hou"></span>
            </div>
            <div class="two">
                <div class="qian">推荐人账号：</div>
                <input class="inp" type="text" placeholder="推荐人的登录账号"  id="p_name" name="p_name" value="{$p_name}" />
                <input class="inp" type="hidden"   id="p_id" name="p_id" value="{$p_id}" />
                <span class="zhong">*</span>
                <span class="hou"></span>
            </div>
            <div class="two">
                <input class="xuan" type="checkbox" />
                <a href="">我已阅读并同意相关用户协议和条款</a>
            </div>
            <div class="two">
                <input class="tijiao" type="button" value="提交注册" onclick="check()" />
            </div>
        </form>
    </div>
</div>
<script type="text/javascript">
	//返回一个图标
	function isError(state){
		if(state==0){
			return "<b class='error' style='float: left;width: 20px;height: 20px;margin-top:15px;margin-left:5px;background:url(\"__PUBLIC__/images/error1.gif\");background-size:100% 100%;'></b>";
		}else{
			return "<b class='right' style='float: left;width: 20px;height: 20px;margin-top:15px;margin-left:5px;background:url(\"__PUBLIC__/images/right1.gif\");background-size:100% 100%;'></b>";
		}
	}
    //检查名字是否可用
    $('#name').bind('blur', function(){
        var name =$(this).val();
        var path = "{:U('login/ajaxCheckName')}";
         if(name.trim()!=""){
           if(/\w{6,16}/g.test($("#name").val())){
                 $.ajax({
                    type : "post",
                    url : path,
                    data : JSON.stringify({name:name}),
                    async : true,
                    success : function(data){
                        //return_handle(data);
                        if(data.result=='SUCCESS'){
                            //location.href= data.return_data.url;
                           showMsg($("#name").siblings(".hou"),isError(1)+"该帐号可以使用","#000");
                        }else{
                            showMsg($("#name").siblings(".hou"),isError(0)+"该帐号已被注册","#000");
                        }
                    }
                 });
             }else{
                  showMsg($("#name").siblings(".hou"),isError(0)+"帐号为6-16位","#000");
                }
        	
        }else{
        	alert("请输入帐号");
        }
    });

   	//错误提示
	function showMsg(el,text,color){
	    if(!color){color="red"}
	    $(el).css("display","block");
	    $(el).html(text);
	    $(el).css("color",color);
	}
    //检查手机号是否可用
    $('#mobile').bind('blur', function(){
        var mobile =$(this).val();
        var path = "{:U('login/ajaxCheckmobile')}";
        if(mobile.trim()!==""){
        	if(checkMobile(mobile)){
	        	$.ajax({
		            type : "post",
		            url : path,
		            data : JSON.stringify({mobile:mobile}),
		            async : false,
		            success : function(data){
		                //return_handle(data);
		                if(data.result=='SUCCESS'){
		                   	showMsg($("#mobile").siblings(".hou"),isError(1)+"该手机号可以使用","#000");
		                }else{
		                   showMsg($("#mobile").siblings(".hou"),isError(0)+"该手机已被注册","#000");
		                }

		            }
	        	});
	        
	        }else{
 				 showMsg($("#mobile").siblings(".hou"),isError(0)+"手机号格式不正确","#000");
	        }
        }else{
	        alert("手机号不能为空");
	   }
    });
	//验证手机
	function checkMobile(ph){
	    if(/^1[3,5,7,8]\d{9}$/g.test(ph)){
	        return true;
	    }else{
	        return false;
	    }
	}

    //检查推荐人是否正确存在
    $('#p_name').bind('blur', function(){
        var p_name =$(this).val();
        var path = "{:U('login/ajaxCheckPid')}";
	        if(p_name.trim()!==""){
	   		$.ajax({
	            type : "post",
	            url : path,
	            data : JSON.stringify({p_name:p_name}),
	            async : false,
	            success : function(data){
	                //return_handle(data);
	                if(data.result=='SUCCESS'){
	                    //location.href= data.return_data.url;
                        $('#p_id').val(data.return_data.p_id);
	                    showMsg($("#p_name").siblings(".hou"),isError(1)+"正确","#000");

	                }else{
	                  showMsg($("#p_name").siblings(".hou"),isError(0)+data.msg,"#000");

	                }

	            }
	        });
        }else{
        	showMsg($("#p_name").siblings(".hou"),isError(0)+"推荐人不能为空","#000");
        }
     

    });
    $("#pwd").on("blur",function(){
    	var pwd=$("#pwd").val();
    	if(pwd.trim()!==""){
    		if(!/\w{6,16}/g.test(pwd)){
				showMsg($("#pwd").siblings(".hou"),isError(0)+"密码格式错误","#000");
    		}else{
    			showMsg($("#pwd").siblings(".hou"),isError(1)+"此密码可用","#000");
    		}
    	}else{
    		 showMsg($("#pwd").siblings(".hou"),isError(0)+"密码不能为空","#000");
    	}
    });
     $("#repwd").on("blur",function(){
    	var repwd=$("#repwd").val();
    	if(repwd.trim()!==""){
    		if(/\w{6,16}/g.test(repwd)){
				if(repwd!==$("#pwd").val().trim()){
					showMsg($("#repwd").siblings(".hou"),isError(0)+"两次密码不一致","#000");
				}else{
					showMsg($("#repwd").siblings(".hou"),isError(1)+"验证成功","#000");
				}
    		}else{
    			showMsg($("#repwd").siblings(".hou"),isError(0)+"确认密码格式错误","#000");
    		}
    	}else{
    		 showMsg($("#repwd").siblings(".hou"),isError(0)+"确认密码不能为空","#000");
    	}
    });
     $("#family_name").on("blur",function(){
        if($("#family_name").val().trim()==""){
            showMsg($("#family_name").siblings(".hou"),isError(0)+"姓名不能为空","#000");
            return false;
        }else{
            showMsg($("#family_name").siblings(".hou"),isError(1)+"验证成功","#000");
        }
     });
    function validate_handle(){
        //todo
        return true;

    }
    function check(){
        if($("#name").val().trim()==""){
            showMsg($("#name").siblings(".hou"),isError(0)+"帐号不能为空","#000");
            return false;
        }else{
            if(/\w{6,16}/g.test($("#name").val())){
                  var path = "{:U('login/ajaxCheckName')}";
                  var name=$("#name").val();

                $.ajax({
                    type : "post",
                    url : path,
                    data : JSON.stringify({name:name}),
                    async : true,
                    success : function(data){
                        if(data.result=='SUCCESS'){
                            showMsg($("#name").siblings(".hou"),isError(1)+"正确","#000");

                        }else{
                          showMsg($("#name").siblings(".hou"),isError(0)+data.msg,"#000");
                            return false;
                        }

                    }
                });

                console.log("name 有问题");
            }else{
                  showMsg($("#name").siblings(".hou"),isError(0)+"帐号为6-16位","#000");
                 return false;
            }
           
        }
        if($("#pwd").val().trim()==""){
            showMsg($("#pwd").siblings(".hou"),isError(0)+"密码不能为空","#000");
            return false;
        }else{
             if(!/\w{6,16}/g.test($("#pwd").val())){
                showMsg($("#pwd").siblings(".hou"),isError(0)+"密码格式错误","#000");
                return false;
            }else{
                showMsg($("#pwd").siblings(".hou"),isError(1)+"此密码可用","#000");
            }
        }
        console.log($("#repwd").val().trim());
         if($("#repwd").val().trim()==""){
            showMsg($("#repwd").siblings(".hou"),isError(0)+"确认密码不能为空","#000");
           return false;
         }else{
            if($("#repwd").val().trim()!==$("#pwd").val().trim()){
                showMsg($("#repwd").siblings(".hou"),isError(0)+"两次密码不一致","#000");
                return false;
            }else{
                 showMsg($("#repwd").siblings(".hou"),isError(1)+"验证成功","#000");
            }
         }
        
        if($("#family_name").val().trim()==""){
            showMsg($("#family_name").siblings(".hou"),isError(0)+"姓名不能为空","#000");
            return false;
        }else{
            showMsg($("#family_name").siblings(".hou"),isError(1)+"验证成功","#000");
        }
       // if($("#mobile").trim()!==""){
        var mb= $("#mobile").val();
        if($.trim(mb)!==""){
            if(checkMobile($("#mobile").val())){
                 var path = "{:U('login/ajaxCheckmobile')}";
                $.ajax({
                    type : "post",
                    url : path,
                    data : JSON.stringify({mobile:$("#mobile").val()}),
                    async : false,
                    success : function(data){
                        //return_handle(data);
                        if(data.result=='SUCCESS'){
                            showMsg($("#mobile").siblings(".hou"),isError(1)+"该手机号可以使用","#000");
                        }else{
                           showMsg($("#mobile").siblings(".hou"),isError(0)+"该手机已被注册","#000");
                           return false;
                        }

                    }
                });
            
            }else{
                 showMsg($("#mobile").siblings(".hou"),isError(0)+"手机号格式不正确","#000");
                 return false;
            }
        }else{
            showMsg($("#mobile").siblings(".hou"),isError(0)+"手机号不能为空","#000");
            return false;
        }
       if($("#p_name").val().trim()!==""){
            var path = "{:U('login/ajaxCheckPid')}";
            $.ajax({
                type : "post",
                url : path,
                data : JSON.stringify({p_name:$("#p_name").val()}),
                async : false,
                success : function(data){
                    //return_handle(data);
                    if(data.result=='SUCCESS'){
                        //location.href= data.return_data.url;
                        $('#p_id').val(data.return_data.p_id);
                        showMsg($("#p_name").siblings(".hou"),isError(1)+"正确","#000");

                    }else{
                      showMsg($("#p_name").siblings(".hou"),isError(0)+data.msg,"#000");
                      return false;

                    }

                }
            });
       }else{
            showMsg($("#p_name").siblings(".hou"),isError(0)+"推荐人不能为空","#000");
            return false;
       }
        sub(1);
    }
</script>
</body>
</html>
